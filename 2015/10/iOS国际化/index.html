<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>iOS国际化 | mokai</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="在真正将国际化实践前，只知道通过NSLocalizedString方法将相应语言的字符串加载进来即可。但最近公司项目的新需求增加英文版本，并支持应用内无死角切换~，这才跳过各种坑实现了应用内切换语言，并记录至此。">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS国际化">
<meta property="og:url" content="http://mokai.github.io/2015/10/iOS国际化/index.html">
<meta property="og:site_name" content="mokai">
<meta property="og:description" content="在真正将国际化实践前，只知道通过NSLocalizedString方法将相应语言的字符串加载进来即可。但最近公司项目的新需求增加英文版本，并支持应用内无死角切换~，这才跳过各种坑实现了应用内切换语言，并记录至此。">
<meta property="og:image" content="http://7xiew0.com1.z0.glb.clouddn.com/locale_0.gif">
<meta property="og:image" content="http://7xiew0.com1.z0.glb.clouddn.com/locale_1.png">
<meta property="og:image" content="http://7xiew0.com1.z0.glb.clouddn.com/locale_1_1.png">
<meta property="og:image" content="http://7xiew0.com1.z0.glb.clouddn.com/locale_1_2.png">
<meta property="og:image" content="http://7xiew0.com1.z0.glb.clouddn.com/locale_1_3.png">
<meta property="og:image" content="http://7xiew0.com1.z0.glb.clouddn.com/locale_2.png">
<meta property="og:image" content="http://7xiew0.com1.z0.glb.clouddn.com/locale_2_1.png">
<meta property="og:image" content="http://7xiew0.com1.z0.glb.clouddn.com/locale_3.png">
<meta property="og:image" content="http://7xiew0.com1.z0.glb.clouddn.com/locale_4.png">
<meta property="og:image" content="http://7xiew0.com1.z0.glb.clouddn.com/locale_4_1.png">
<meta property="og:image" content="http://7xiew0.com1.z0.glb.clouddn.com/locale_5.png">
<meta property="og:image" content="http://7xiew0.com1.z0.glb.clouddn.com/locale_5_1.png">
<meta property="og:image" content="http://7xiew0.com1.z0.glb.clouddn.com/locale_5_2.png">
<meta property="og:image" content="http://7xiew0.com1.z0.glb.clouddn.com/locale_6.png">
<meta property="og:image" content="http://7xiew0.com1.z0.glb.clouddn.com/locale_6_1.png">
<meta property="og:image" content="http://7xiew0.com1.z0.glb.clouddn.com/locale_6_2.png">
<meta property="og:image" content="http://7xiew0.com1.z0.glb.clouddn.com/locale_6_3.png">
<meta property="og:updated_time" content="2015-10-04T02:19:37.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOS国际化">
<meta name="twitter:description" content="在真正将国际化实践前，只知道通过NSLocalizedString方法将相应语言的字符串加载进来即可。但最近公司项目的新需求增加英文版本，并支持应用内无死角切换~，这才跳过各种坑实现了应用内切换语言，并记录至此。">
  
    <link rel="alternative" href="/atom.xml" title="mokai" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/me.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">kk</a></h1>
		</hgroup>

		
		<p class="header-subtitle">专注iOS的全栈开发者</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
							<li><a href="/projects">作品</a></li>
				        
							<li><a href="/me">我</a></li>
				        
							<li><a href="/me/resume.html">简历</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="http://github.com/mokai" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/mokaiZz" title="weibo">weibo</a>
					        
								<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/国际化/" style="font-size: 10px;">国际化</a> <a href="/tags/蓝牙/" style="font-size: 10px;">蓝牙</a>
					</div>
				</section>
				
				
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">kk</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/me.png" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">kk</h1>
			</hgroup>
			
			<p class="header-subtitle">专注iOS的全栈开发者</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/projects">作品</a></li>
		        
					<li><a href="/me">我</a></li>
		        
					<li><a href="/me/resume.html">简历</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="http://github.com/mokai" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/mokaiZz" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-iOS国际化" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/iOS国际化/" class="article-date">
  	<time datetime="2015-10-03T16:00:00.000Z" itemprop="datePublished">2015-10-04</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      iOS国际化
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/国际化/">国际化</a></li></ul>
	</div>

        
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/记录/">记录</a>
	</div>


        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在真正将国际化实践前，只知道通过<code>NSLocalizedString</code>方法将相应语言的字符串加载进来即可。但最近公司项目的新需求增加英文版本，并支持应用内无死角切换~，这才跳过各种坑实现了应用内切换语言，并记录至此。</p>
<a id="more"></a>
<h3 id="环境">环境</h3><p>系统环境: iOS7 - iOS9</p>
<p>开发环境: Swift2 &amp; Xcode7</p>
<p>DEMO: <a href="https://github.com/mokai/LocalDemo" target="_blank" rel="external">LocalDemo</a></p>
<p><img src="http://7xiew0.com1.z0.glb.clouddn.com/locale_0.gif" alt=""></p>
<p>这个Demo的功能主要是切换语言后相应的界面文字&amp;图片以及搜索引擎都会随语言变化。我们会围绕这个DEMO进行讲解，读者可以先下载这个Demo运行看下效果再往下</p>
<p><br></p>
<h3 id="iOS国际化原理分析">iOS国际化原理分析</h3><p>国际化其实都大同小异，其核心思想就是<code>为每种语言单独定义一份资源</code>。</p>
<p>iOS就是通过<code>xxx.lproj</code>目录来定义每个语言的资源，这里的资源可以是图片，文本，Storyboard，Xib等。我们可以看看LocalDemo源代码的物理目录结构</p>
<p>Base，暂时无需理会</p>
<p><img src="http://7xiew0.com1.z0.glb.clouddn.com/locale_1.png" alt=""></p>
<p>English</p>
<p><img src="http://7xiew0.com1.z0.glb.clouddn.com/locale_1_1.png" alt=""></p>
<p>中文</p>
<p><img src="http://7xiew0.com1.z0.glb.clouddn.com/locale_1_2.png" alt=""></p>
<p>每种语言都有自己的 <a href="http://www.lingoes.cn/zh/translator/langcode.htm" target="_blank" rel="external">语言代码</a>.lproj文件夹，加载资源时只需要加载相应语言文件夹下的资源就OK，这步可以系统为我们完成，也可以手动去做。</p>
<blockquote>
<p>项目源代码中如果有多个不同目录的国际化资源，则会有产生多个xxx.lproj，但在编译打包后，会集中放在app的根目录中的xxx.lproj中，不信你看~</p>
</blockquote>
<p><img src="http://7xiew0.com1.z0.glb.clouddn.com/locale_1_3.png" alt=""><br><br></p>
<h3 id="开始国际化">开始国际化</h3><p>首先点击项目-&gt;PROJECT-&gt;Info-&gt;Localizations中添加要支持的语言</p>
<p><img src="http://7xiew0.com1.z0.glb.clouddn.com/locale_2.png" alt=""></p>
<blockquote>
<p>此处Use Base Internationalization开启状态下，每个国际化资源文件会有个Base选项，主要针对String，Storyboard，Xib作为一个基础的模板，像后述<a href="#storyboard_2">storyboard国际化中方案二</a>就是基于Base StoryBoard进行改动。</p>
</blockquote>
<p>在点击<code>+</code> 添加相应语言时会弹出以下对话框，意思是为现有的资源添加语言文件，我们点击<code>Finish</code>就行了</p>
<p><img src="http://7xiew0.com1.z0.glb.clouddn.com/locale_2_1.png" alt=""></p>
<p><br></p>
<h3 id="文本的国际化">文本的国际化</h3><p>主要针对代码中的字符串进行国际化，比如说一些消息，UI标题等。</p>
<p>我们通过一个<code>Localizable.strings</code>文件来存储每个语言的文本，它是iOS默认加载的文件，如果想用自定义名称命名，在使用<code>NSLocalizedString</code>方法时指定tableName为自定义名称就好了，但你的应用规模不是很大就不要分模块搞特殊了。</p>
<p>每个资源文件如果想为一种语言添加支持，通过其属性面板中的<code>Localization</code>添加相应语言就行了，此时<code>Localizable.strings</code>处于可展开状态，子级有着相应语言的副本。我们把相应语言的文本放在副本里面就行了</p>
<p><img src="http://7xiew0.com1.z0.glb.clouddn.com/locale_3.png" alt=""></p>
<blockquote>
<p>此处Base与前面提过到的<code>开启Use Base Internationalization</code>是有关联的，只有开启了全局<code>Use Base Internationalization</code>此处才会显示。那为什么这里没有勾选Base？Base做为一个基础模板，作用于Strings文件是没有太大意义的，另外去掉Base意义着在Base.lproj中少了一个strings文件，APP大小也所有下降，这点对于图片的Base更是如此</p>
</blockquote>
<p>在上图可以看到其实就是为每一套语言新建一份strings，其内容采用<code>&quot;key&quot; = &quot;value&quot;;</code>的格式，注意有<code>;</code>号</p>
<p>我们在代码中这样写就行了<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">NSLocalizedString</span><span class="params">(<span class="string">"首页"</span>,comment: <span class="string">""</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">NSLocalizedString</span><span class="params">(<span class="string">"好友"</span>,comment: <span class="string">""</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">NSLocalizedString</span><span class="params">(<span class="string">"我"</span>,comment: <span class="string">""</span>)</span></span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>另外中文strings【Localizable.strings(Simplified)】可以不要的(可以理解为中文为APP的默认语言)，因为key就是value，当找不到相应的语言strings或value时会直接返回key。nice！这样一来我们做文本的国际化就只要维护一个英文副本strings就O了</p>
</blockquote>
<p><br></p>
<h3 id="图片的国际化">图片的国际化</h3><p>二种方案，通过原生支持与自定义命名</p>
<blockquote>
<p>注意，新版Xcode中Images.xcassets不支持国际化（属性页面中没有<code>Localization</code>），Xcode5以前是支持的</p>
</blockquote>
<ul>
<li><p>方案一：自定义文本命名</p>
<p>  <img src="http://7xiew0.com1.z0.glb.clouddn.com/locale_4.png" alt=""></p>
<p>  利用文本国际化的方式，在代码中调用</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UIImage<span class="list">(<span class="keyword">named</span>: NSLocalizedString<span class="list">(<span class="string">"search_logo"</span>,comment: <span class="string">""</span>)</span>)</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>不推荐，一是因为做法太low了，工作量明显加大。二是不能在Storyboard或XIB中使用</p>
</blockquote>
</li>
<li><h6 id="方案二：原生支持">方案二：原生支持</h6><p><img src="http://7xiew0.com1.z0.glb.clouddn.com/locale_4_1.png" alt=""></p>
<blockquote>
<p>同上，Base副本去掉。另外需要注意的是，使用这种方式，在XIB或Storyboard中引用图片时如果只使用名称是实时显示不了的，一定要加上后缀名。如avater.png</p>
</blockquote>
<p>  使用方式不变，iOS会自动找相应语言(xxx.lproj)下的图片</p>
  <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">UIImage</span><span class="params">(named: <span class="string">"avater"</span>)</span></span></span><br></pre></td></tr></table></figure>
<p>  对于图片的放置，正确姿态应该是<code>需要国际化的图片放在自定义Group里面，不需要国际化的图片放在Images.xcassets</code></p>
</li>
</ul>
<p><br></p>
<h3 id="Storyboard&amp;XIB的国际化">Storyboard&amp;XIB的国际化</h3><p>前面的两种资源国际化比较简单，但Storyboard国际化就稍微麻烦了点。同样它也有二种方案</p>
<ul>
<li><p>方案一：每种语言定制一套Storyboard</p>
<p>  <img src="http://7xiew0.com1.z0.glb.clouddn.com/locale_5.png" alt=""></p>
<p>  在上图我们可以看到，每种语言都可以切换为strings或Storyboard（默认为strings）。如果选用<code>Interface Builder Storyboard</code>方案，那么每种语言都有一套相应的Storyboard，各个语言Storyboard间的界面改动不关联</p>
</li>
<li><p>方案二：基于基础的<code>Base StoryBoard</code>以及每种语言一套strings <a id="storyboard_2"></a></p>
<p>  <img src="http://7xiew0.com1.z0.glb.clouddn.com/locale_5_1.png" alt=""></p>
<p>基于一个基础的Storyboard，可以看作是一个基础的模板，Storyboard里面所有的文本类资源(如UILabel的text)都会被放在相应语言的strings里面。此时我们为Storyboard里的字符类资源作国际化只需要编辑相应语言的strings就行了</p>
</li>
</ul>
<p>首选方案二。因为采用方案一，意义着你每改动一个界面元素就得去相应语言Storyboard一一改动，那跟为每个语言新起一个项目是一样的道理。但是采用方案二，我们只需改动Base Storyboard就行了</p>
<blockquote>
<p>注意，方案二中相应语言的strings一旦生成后，Base Storyboard有任何编辑都不会影响到strings，这就意味着如果我们删除或添加了一个UILabel的text，strings也不能同步改动</p>
</blockquote>
<p>  还好，Xcode为我们提供了<code>ibtool</code>工具来生成Storyboard的strings文件。</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ibtool Main.storyboard --<span class="keyword">generate</span>-strings-<span class="keyword">file</span> ./NewTemp.<span class="literal">string</span></span><br></pre></td></tr></table></figure>
<p>  但是ibtool生成的strings文件是BaseStoryboard的strings(默认语言的strings)，且会把我们原来的strings替换掉。所以我们要做的就是把新生成的strings与旧的strings进行冲突处理(新的附加上，删除掉的注释掉)，这一切可以用这个pythoy脚本来实现，见<a href="https://raw.githubusercontent.com/mokai/iOS-i18n/master/i18n/RunScript/AutoGenStrings.py" target="_blank" rel="external">AutoGenStrings.py</a>。然后我们将借助<code>Xcode 中 Run Script</code>来运行这段脚本。这样每次Build时都会保证语言strings与Base Storyboard保持一致</p>
<p><img src="http://7xiew0.com1.z0.glb.clouddn.com/locale_5_2.png" alt=""></p>
<p><br></p>
<h4 id="应用内切换语言">应用内切换语言</h4><p>应用启动时，首先会读取NSUserDefaults中的key为<code>AppleLanguages</code>的内容，该key返回一个String数组，存储着APP支持的语言列表，数组的第一项为APP当前默认的语言。</p>
<p>在安装后第一次打开APP时，会自动初始化该key为当前系统的语言编码，如简体中文就是zh-Hans。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取APP当前语言</span></span><br><span class="line">(NSUserDefaults.<span class="function"><span class="title">standardUserDefaults</span><span class="params">()</span></span>.<span class="function"><span class="title">valueForKey</span><span class="params">(<span class="string">"AppleLanguages"</span>)</span></span> as! Array&lt;String&gt;)[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<p>那么我们要实现语言切换改变<code>AppleLanguages</code>的值即可，但是这里有一个坑，因为苹果没提供给我们直接修改APP默认语言的API，我们只能通过NSUserDefaults手动去操作，且<code>AppleLanguages</code>的值改变后APP得重新启动后才会生效（才会读取相应语言的lproj中的资源，意义着就算你改了，资源还是加载的APP启动时lproj中的资源），猜测应该是框架层在第一次加载时对<code>AppleLanguages</code>的值进行了内存缓冲</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置APP当前语言</span></span><br><span class="line"><span class="tag">var</span> def = NSUserDefaults.<span class="function"><span class="title">standardUserDefaults</span><span class="params">()</span></span></span><br><span class="line">def.<span class="function"><span class="title">setValue</span><span class="params">([“zh-Hans”], forKey:<span class="string">"AppleLanguages"</span>)</span></span></span><br><span class="line">def.<span class="function"><span class="title">synchronize</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>
<p>那么问题来了，如何做到改变<code>AppleLanguages</code>的值就加载相应语言的lproj资源？</p>
<p>其实，APP中的Storyboard的加载，图片与字符串的加载都是在<code>NSBundle.mainBundle()</code>上操作的，那么我们只要在语言切换后把<code>NSBundle.mainBundle()</code>替换成当前语言的bundle就行了，这样系统通过<code>NSBundle.mainBundle()</code>去加载资源时实则是加载的当前语言bundle中的资源</p>
<blockquote>
<p>lproj目录可以用一个NSBundle表示</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">Foundation</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">*  当调用onLanguage后替换掉mainBundle为当前语言的bundle</span><br><span class="line">*/</span></span><br><span class="line">private  <span class="keyword">let</span> _bundle:<span class="type">UnsafePointer</span>&lt;<span class="type">Void</span>&gt; =  unsafeBitCast(<span class="number">0</span>,<span class="type">UnsafePointer</span>&lt;<span class="type">Void</span>&gt;.<span class="keyword">self</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BundleEx</span>: <span class="title">NSBundle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="func"><span class="keyword">func</span> <span class="title">localizedStringForKey</span><span class="params">(key: String, value: String?, table tableName: String?)</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> bundle = languageBundle() &#123;</span><br><span class="line">            <span class="keyword">return</span> bundle.localizedStringForKey(key, value: value, table: tableName)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">super</span>.localizedStringForKey(key, value: value, table: tableName)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">NSBundle</span></span>&#123;</span><br><span class="line">    private <span class="class"><span class="keyword">struct</span> <span class="title">Static</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">var</span> onceToken : dispatch_once_t = <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="func"><span class="keyword">func</span> <span class="title">onLanguage</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//替换NSBundle.mainBundle()为自定义的BundleEx</span></span><br><span class="line">        dispatch_once(&amp;<span class="type">Static</span>.onceToken) &#123;</span><br><span class="line">            object_setClass(<span class="type">NSBundle</span>.mainBundle(), <span class="type">BundleEx</span>.<span class="keyword">self</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//当前语言的bundle</span></span><br><span class="line">    <span class="func"><span class="keyword">func</span> <span class="title">languageBundle</span><span class="params">()</span></span>-&gt;<span class="type">NSBundle</span>?&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Languager</span>.standardLanguager().currentLanguageBundle</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上<code>Languager</code>是 <a href="https://github.com/mokai/iOS-i18n" target="_blank" rel="external">iOS-i18n</a> 开源库的一部分，我把项目中国际化部分封装了下，有兴趣的童鞋可以去看看 </p>
<h3 id="其他">其他</h3><ul>
<li><p>设置运行语言环境</p>
<p>有时我们第一次安装APP时不想默认跟随系统，那么可以通过Xcode的scheme来指定特定语言</p>
<p><img src="http://7xiew0.com1.z0.glb.clouddn.com/locale_6.png" alt=""></p>
</li>
<li><p>Storyboard实时预览</p>
<p>直接上图~</p>
<p><img src="http://7xiew0.com1.z0.glb.clouddn.com/locale_6_1.png" alt=""></p>
</li>
</ul>
<ul>
<li><p>IB中UIImageView国际化无效</p>
<p>解决办法就是为<code>UIImageView</code>扩展一个方法，然后通过IB中的<code>User Defined Runtime Attributes</code>把imageName传进去</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UIImageView</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> locale:<span class="type">String</span>&#123;</span><br><span class="line">        <span class="keyword">get</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span>(newlocale)&#123;</span><br><span class="line">            <span class="keyword">self</span>.image = localizedImage(newlocale)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  <img src="http://7xiew0.com1.z0.glb.clouddn.com/locale_6_2.png" alt=""></p>
</li>
<li><p>IB中UITextView国际化无效</p>
<p>解决办法和UIImageView类似，扩展一个方法，然后把self.text做为key去strings文件中拿相应语言的value</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UITextView</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> locale:<span class="type">Bool</span>&#123;</span><br><span class="line">        <span class="keyword">get</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span>(newlocale)&#123;</span><br><span class="line">            <span class="keyword">self</span>.text = localized(<span class="keyword">self</span>.text)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://7xiew0.com1.z0.glb.clouddn.com/locale_6_3.png" alt=""></p>
</li>
</ul>
<ul>
<li><p>LaunchScreen.xib的国际化</p>
<p> 很遗憾，到目前为止，还不支持LaunchScreen.xib的国际化，我们只能通过自定义一个LaunchViewController来完成此需求，但也有些不足，就是应用启动时会黑屏一段时间，所以建议启动页面不要弄国际化</p>
</li>
</ul>
<p>参考:</p>
<ul>
<li><a href="http://www.cnblogs.com/levilinxi/p/4296712.html" target="_blank" rel="external">iOS国际化——通过脚本使storyboard翻译自增</a></li>
<li><a href="https://medium.com/ios-apprentice/working-with-localization-905e4052b9de" target="_blank" rel="external">Working with Localization</a></li>
<li><a href="http://stackoverflow.com/questions/1669645/how-to-force-nslocalizedstring-to-use-a-specific-language" target="_blank" rel="external">How to force NSLocalizedString to use a specific language</a></li>
</ul>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/10/ios-bug-1/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          #坑1# iOS8以后presendViewController透明效果无效
        
      </div>
    </a>
  
  
    <a href="/2015/09/bluetooth_guide/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">蓝牙编程</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>




<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="iOS国际化" data-title="iOS国际化" data-url="http://mokai.github.io/2015/10/iOS国际化/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"mokai"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>




</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2015 kk
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>